#####################################################################################
# Operating System #
####################
FROM debian:latest

#####################################################################################
# Maintenance #
###############
RUN apt update 
RUN apt install -y systemd
RUN apt install -y systemd-sysv
RUN apt install -y openssh-server

#####################################################################################
# Configuration #
#################
RUN sed -i 's/#PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN systemctl enable ssh

#####################################################################################
# User #
########
RUN useradd -m -s /bin/bash marc
RUN usermod -aG sudo marc

#####################################################################################
# Passwd #
##########
RUN echo "marc:admin" | chpasswd
RUN echo "root:admin" | chpasswd

#####################################################################################
# WorkDir #
###########
WORKDIR /home/marc


##############################################################################################
# Cr√©ez l'utilisateur et le groupe docker #
###########################################
RUN groupadd -r    docker
RUN useradd  -r -g docker docker

##############################################################################################
# Configure systemd pour utiliser l'utilisateur et le groupe docker #
#####################################################################
RUN sed -i 's/^User=.*/User=marc/'   /etc/systemd/system.conf
RUN sed -i 's/^Group=.*/Group=marc/' /etc/systemd/system.conf

#####################################################################################
# Start-up #
############
USER marc
CMD ["/usr/lib/systemd/systemd", "--user"]

#CMD ["su", "marc"]

